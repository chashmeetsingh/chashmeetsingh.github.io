<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <script>
        // UNCOMMENT AND USE YOUR VARIABLES FOR DISQUS AND GOOGLE ANALYTICS
        // var d_id  = '',
        //     g_id  = 'UA-XXXXXXXX-X', // Format: UA-########-#, Example: UA-11220899-1
        //     g_url = 'XXXXXXX.XXX' // Format: #####.####, Example: webdesignporto.com
    </script>

    <title>iOS Client Features</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="//chashmeetsingh.github.io/themes/the-shell/assets/highlighter/prettify.css?v=1495265893241" />
    <link rel="stylesheet" type="text/css" href="//chashmeetsingh.github.io/themes/the-shell/assets/css/screen.css?v=1495265893241" />

    <link rel="canonical" href="https://chashmeetsingh.github.io/2017/05/20/iOS-Client-Features.html" />
    <meta name="referrer" content="origin" />
    
    <meta property="og:site_name" content="Chashmeet Singh" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="iOS Client Features" />
    <meta property="og:description" content=".post-title {     margin-bottom: 30px;   } What feature are we talking about? We are going to discuss only one feature this time, we will see the rest next time. It is: Calculation of the height and width of the Chat Message Bubble So let&amp;#8217;s start first with the implementation of the" />
    <meta property="og:url" content="https://chashmeetsingh.github.io/2017/05/20/iOS-Client-Features.html" />
    <meta property="article:published_time" content="2017-05-20T00:00:00.000Z" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="iOS Client Features" />
    <meta name="twitter:description" content=".post-title {     margin-bottom: 30px;   } What feature are we talking about? We are going to discuss only one feature this time, we will see the rest next time. It is: Calculation of the height and width of the Chat Message Bubble So let&amp;#8217;s start first with the implementation of the" />
    <meta name="twitter:url" content="https://chashmeetsingh.github.io/2017/05/20/iOS-Client-Features.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Chashmeet Singh",
    "author": {
        "@type": "Person",
        "name": "Chashmeet Singh",
        "image": "https://avatars0.githubusercontent.com/u/8962264?v=3",
        "url": "https://chashmeetsingh.github.io/author/chashmeetsingh/",
        "sameAs": "http://chashmeetsingh.com",
        "description": "Full Stack Developer"
    },
    "headline": "iOS Client Features",
    "url": "https://chashmeetsingh.github.io/2017/05/20/iOS-Client-Features.html",
    "datePublished": "2017-05-20T00:00:00.000Z",
    "description": ".post-title {     margin-bottom: 30px;   } What feature are we talking about? We are going to discuss only one feature this time, we will see the rest next time. It is: Calculation of the height and width of the Chat Message Bubble So let&amp;#8217;s start first with the implementation of the"
}
    </script>

    <meta name="generator" content="HubPress" />
    <link rel="alternate" type="application/rss+xml" title="Chashmeet Singh" href="https://chashmeetsingh.github.io/rss/" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/atom-one-dark.min.css">

</head>
<body class="post-template">

    

<main class="content" role="main">

    <article class="post">

        <header class="post-header">
            <a id="blog-logo" href="https://chashmeetsingh.github.io">
                    <img src="https://avatars0.githubusercontent.com/u/8962264?v&#x3D;3&amp;u&#x3D;469ed48e3bde5ec302aeb6e4245d1eff464fbf80&amp;s&#x3D;400" alt="Blog Logo" />
            </a>
        </header>


        <span class="post-meta"><time datetime="2017-05-20">20 May 2017</time> </span>

        <h1 class="post-title">iOS Client Features</h1>

        <section class="post-content">
            <div id="preamble">
<div class="sectionbody">
<style>
  .post-title {
    margin-bottom: 30px;
  }
</style>
</div>
</div>
<div class="sect2">
<h3 id="_what_feature_are_we_talking_about">What feature are we talking about?</h3>
<div class="paragraph">
<p>We are going to discuss only one feature this time, we will see the rest next time. It is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Calculation of the height and width of the Chat Message Bubble</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So let&#8217;s start first with the implementation of the movement made by the message container when the keyboard is toggled.</p>
</div>
<div class="paragraph">
<p>Now, in order to detect whether the keyboard is showing or not, we need an observer that watches the showing and hiding of the keyboard at all times.</p>
</div>
<div class="paragraph">
<p>So here are the two method we use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>NotificationCenter.default.addObserver(self, selector: #selector(handleKeyboardNotification), name: NSNotification.Name.UIKeyboardWillShow, object: nil)

NotificationCenter.default.addObserver(self, selector: #selector(handleKeyboardNotification), name: NSNotification.Name.UIKeyboardWillHide, object: nil)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s break these down.</p>
</div>
<div class="paragraph">
<p>The first one adds an observer which watches whether the keyboard is open or not and based on that calls a method. Here the <code>NSNotification.Name.UIKeyboardWillShow</code> Notification is used to detect this.</p>
</div>
<div class="paragraph">
<p>Same goes for the second observer but here we use the <code>NSNotification.Name.UIKeyboardWillHide</code> Notification.</p>
</div>
<div class="paragraph">
<p>Both these observer when observe the change, call a method <code>handleKeyboardNotification</code> which we are going to checkout next.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start developing this function.</p>
</div>
<div class="paragraph">
<p>So, what exactly do we need next?
We need the keyboard&#8217;s height so that we can add / subtract it to the <code>bottomConstraint</code> that holds the message container at the bottom based on whether the keyboard is showing or not.</p>
</div>
<div class="paragraph">
<p>This method takes in the <code>NSNotification</code> paramter, which is to get the <code>userInfo</code> from the notification, like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>let userInfo = notification.userInfo</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s grab the keyboard height next. For grabbing this we use the <code>UIKeyboardFrameEndUserInfoKey</code> key inside the <code>userInfo</code> we just obtained above. Next, we need to convert this to a rectangle so that we get the frame of the keyboard. We do this by using the <code>cgRectValue</code> attribute which returns the CoreGraphics rectangle structure.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>let keyboardFrame = (userInfo[UIKeyboardFrameEndUserInfoKey] as AnyObject).cgRectValue</pre>
</div>
</div>
<div class="paragraph">
<p>Next let&#8217;s check whether the keyboard is being shown or hidden.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>let isKeyboardShowing = notification.name == NSNotification.Name.UIKeyboardWillShow</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>notification.name == NSNotification.Name.UIKeyboardWillShow</code> would return <code>true</code> or <code>false</code> by checking the <code>name</code> attribute of the notification that called this function.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s set the bottom constraint for the message container now.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>bottomConstraint?.constant = isKeyboardShowing ? -keyboardFrame!.height : 0</pre>
</div>
</div>
<div class="paragraph">
<p>Here, we check the <code>isKeyboardShowing</code> bool we defined above and based on that we assign the bottom constraint to the bottom of the keyboard if the keyboard is being shown, else we restore it to be at the bottom of the screen.</p>
</div>
<div class="paragraph">
<p>Now, in order to test this functionality we do two things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make a function that subscribes to the notifications</p>
<div class="literalblock">
<div class="content">
<pre>func subscribeToKeyboardNotifications() {
    NotificationCenter.default.addObserver(self, selector: #selector(handleKeyboardNotification), name: NSNotification.Name.UIKeyboardWillShow, object: nil)
    NotificationCenter.default.addObserver(self, selector: #selector(handleKeyboardNotification), name: NSNotification.Name.UIKeyboardWillHide, object: nil)
}</pre>
</div>
</div>
</li>
<li>
<p>Call this function inside <code>viewDidLoad()</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now, we are actually done with the functionality and if we try to run this we will observe that the frame does change but it takes some time for the keyboard to show up.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="http://i.imgur.com/EQS8OPq.gif" alt="Imgur">
</div>
</div>
<div class="paragraph">
<p><em>Note: We have enabled <code>Slow Animations</code> for the simulator to view this better.</em></p>
</div>
<div class="paragraph">
<p>What we can do to resoleve this is, we use the animate method of <code>UIView</code> as follows.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>UIView.animate(withDuration: 0, delay: 0, options: UIViewAnimationOptions.curveEaseOut, animations: {
            self.view.layoutIfNeeded()
}, completion: nil)</pre>
</div>
</div>
<div class="paragraph">
<p>Here, we set the duration to <code>0</code> so that the animation happens without any delay and inside the <code>animations</code> block we have made a call to <code>self.view.layoutIfNeeded</code> which helps to lay out subviews immediately and we have passed <code>nil</code> to the completion block.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s check the working of the feature:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="http://i.imgur.com/EqJ26aU.gif" alt="Imgur">
</div>
</div>
</div>
<div class="sect1">
<h2 id="_awesome">Awesome!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here we finish up the blog post for this week. See you next time!</p>
</div>
</div>
</div>
        </section>


        <footer class="post-footer">

                <section class="author">
                    <h4>Chashmeet Singh</h4>
                    <p>Full Stack Developer</p>
                </section>

            <section class="share">
                <h4>Share this</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=iOS Client Features&url=https://chashmeetsingh.github.io/2017/05/20/iOS-Client-Features.html"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://chashmeetsingh.github.io/2017/05/20/iOS-Client-Features.html"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https://chashmeetsingh.github.io/2017/05/20/iOS-Client-Features.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>


    </article>

</main>


    <footer class="site-footer">
        <!-- <a class="subscribe icon-feed" href="https://chashmeetsingh.github.io/rss/"><span class="tooltip">Subscribe!</span></a> -->
        <div class="inner">
             <section class="copyright">All content copyright <a href="/">Chashmeet Singh</a> &copy; 2017 &bull; All rights reserved.</section>
             <section class="poweredby">Proudly published with <a href="http://hubpress.io">HubPress</span></a> in <a href="https://github.com/mityalebedev/The-Shell">The Shell</a> theme.</section>
        </div>
    </footer>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();
      </script>
       
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

    <script type='text/javascript' src="//chashmeetsingh.github.io/themes/the-shell/assets/highlighter/prettify.js?v=1495265893241"></script>
    <script type='text/javascript' src="//chashmeetsingh.github.io/themes/the-shell/assets/js/shell.js?v=1495265893241"></script>
</body>
</html>
