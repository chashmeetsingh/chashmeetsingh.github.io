<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <script>
        // UNCOMMENT AND USE YOUR VARIABLES FOR DISQUS AND GOOGLE ANALYTICS
        // var d_id  = '',
        //     g_id  = 'UA-XXXXXXXX-X', // Format: UA-########-#, Example: UA-11220899-1
        //     g_url = 'XXXXXXX.XXX' // Format: #####.####, Example: webdesignporto.com
    </script>

    <title>Calculation of the frame size of the Chat Bubble(iOS Client)</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="//chashmeetsingh.github.io/themes/the-shell/assets/highlighter/prettify.css?v=1495476281331" />
    <link rel="stylesheet" type="text/css" href="//chashmeetsingh.github.io/themes/the-shell/assets/css/screen.css?v=1495476281331" />

    <link rel="canonical" href="https://chashmeetsingh.github.io/2017/05/22/Calculation-of-the-frame-size-of-the-Chat-BubbleiOS-Client.html" />
    <meta name="referrer" content="origin" />
    
    <meta property="og:site_name" content="Chashmeet Singh" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Calculation of the frame size of the Chat Bubble(iOS Client)" />
    <meta property="og:description" content=".post-title {     margin-bottom: 80px;   } Starting with the implementation, we will need a UICollectionViewController. import UIKit class ChatViewController: UICollectionViewController, UICollectionViewDelegateFlowLayout {     let cellId &#x3D; &quot;cellId&quot;     override func viewDidLoad() {         super.viewDidLoad()     } } Then, we setup the backgrou" />
    <meta property="og:url" content="https://chashmeetsingh.github.io/2017/05/22/Calculation-of-the-frame-size-of-the-Chat-BubbleiOS-Client.html" />
    <meta property="article:published_time" content="2017-05-22T00:00:00.000Z" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Calculation of the frame size of the Chat Bubble(iOS Client)" />
    <meta name="twitter:description" content=".post-title {     margin-bottom: 80px;   } Starting with the implementation, we will need a UICollectionViewController. import UIKit class ChatViewController: UICollectionViewController, UICollectionViewDelegateFlowLayout {     let cellId &#x3D; &quot;cellId&quot;     override func viewDidLoad() {         super.viewDidLoad()     } } Then, we setup the backgrou" />
    <meta name="twitter:url" content="https://chashmeetsingh.github.io/2017/05/22/Calculation-of-the-frame-size-of-the-Chat-BubbleiOS-Client.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Chashmeet Singh",
    "author": {
        "@type": "Person",
        "name": "Chashmeet Singh",
        "image": "https://avatars0.githubusercontent.com/u/8962264?v=3",
        "url": "https://chashmeetsingh.github.io/author/chashmeetsingh/",
        "sameAs": "http://chashmeetsingh.com",
        "description": "Full Stack Developer"
    },
    "headline": "Calculation of the frame size of the Chat Bubble(iOS Client)",
    "url": "https://chashmeetsingh.github.io/2017/05/22/Calculation-of-the-frame-size-of-the-Chat-BubbleiOS-Client.html",
    "datePublished": "2017-05-22T00:00:00.000Z",
    "description": ".post-title {     margin-bottom: 80px;   } Starting with the implementation, we will need a UICollectionViewController. import UIKit class ChatViewController: UICollectionViewController, UICollectionViewDelegateFlowLayout {     let cellId &#x3D; &quot;cellId&quot;     override func viewDidLoad() {         super.viewDidLoad()     } } Then, we setup the backgrou"
}
    </script>

    <meta name="generator" content="HubPress" />
    <link rel="alternate" type="application/rss+xml" title="Chashmeet Singh" href="https://chashmeetsingh.github.io/rss/" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/atom-one-dark.min.css">

</head>
<body class="post-template">

    

<main class="content" role="main">

    <article class="post">

        <header class="post-header">
            <a id="blog-logo" href="https://chashmeetsingh.github.io">
                    <img src="https://avatars0.githubusercontent.com/u/8962264?v&#x3D;3&amp;u&#x3D;469ed48e3bde5ec302aeb6e4245d1eff464fbf80&amp;s&#x3D;400" alt="Blog Logo" />
            </a>
        </header>


        <span class="post-meta"><time datetime="2017-05-22">22 May 2017</time> </span>

        <h1 class="post-title">Calculation of the frame size of the Chat Bubble(iOS Client)</h1>

        <section class="post-content">
            <style>
  .post-title {
    margin-bottom: 80px;
  }
</style>
<div class="paragraph">
<p>Starting with the implementation, we will need a <code>UICollectionViewController</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>import UIKit

class ChatViewController: UICollectionViewController, UICollectionViewDelegateFlowLayout {

    let cellId = "cellId"

    override func viewDidLoad() {
        super.viewDidLoad()
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, we setup the background of the view and configure the <code>collectionView</code> and call these methods inside inside <code>viewDidLoad</code> .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// Setup View
func setupView() {
   self.view.backgroundColor = UIColor.rgb(red: 236, green: 229, blue: 221)
}

// Setup Collection View
func setupCollectionView() {
    collectionView?.backgroundColor = .clear
    collectionView?.delegate = self

    collectionView?.frame = CGRect(x: 0, y: 0, width: view.frame.width, height: view.frame.height - 50)

    // register cell
    collectionView?.register(UICollectionViewCell.self, forCellWithReuseIdentifier: cellId)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>-50</code> is supposed to be occupied by the <code>Message Container</code>.
Continuing with this, we implement the <code>CollectionView</code> methods as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>    // Number of items to be displayed
    override func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -&gt; Int {
        return 5
    }

    // Configure Cell
    override func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -&gt; UICollectionViewCell {
        let cell = collectionView.dequeueReusableCell(withReuseIdentifier: cellId, for: indexPath)
        cell.backgroundColor = .red
        return cell
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>When trying to run this, we get the following output.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="http://imgur.com/cfodV3e.png" alt="cfodV3e.png"></span></p>
</div>
<div class="paragraph">
<p>We need to increase the width of each cell as well give it a height for displaying a message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>    // Calculate Bubble Height
    func collectionView(_ collectionView: UICollectionView, layout collectionViewLayout: UICollectionViewLayout, sizeForItemAt indexPath: IndexPath) -&gt; CGSize {
        return CGSize(width: view.frame.width, height: 100)
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="http://imgur.com/FGgPXoB.png" alt="FGgPXoB.png"></span></p>
</div>
<div class="paragraph">
<p>To remove the cell spacing we override the edge insets as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>    // Calculate Bubble Height
    func collectionView(_ collectionView: UICollectionView, layout collectionViewLayout: UICollectionViewLayout, sizeForItemAt indexPath: IndexPath) -&gt; CGSize {
        return CGSize(width: view.frame.width, height: 100)
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>We configure a custom Chat Cell to customize the cell according to the needs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>class BaseCell: UICollectionViewCell {
    override init(frame: CGRect) {
        super.init(frame: frame)
        setupViews()
    }

    required init?(coder aDecoder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }

    func setupViews() {}
}

class ChatLogMessageCell: BaseCell {

    let messageTextView: UITextView = {
        let textView = UITextView()
        textView.font = UIFont.systemFontOfSize(18)
        textView.text = "Sample message"
        textView.backgroundColor = UIColor.clearColor()
        return textView
    }()

    let textBubbleView: UIView = {
        let view = UIView()
        view.layer.cornerRadius = 15
        view.layer.masksToBounds = true
        return view
    }()

    static let grayBubbleImage = UIImage(named: "bubble_gray")!.resizableImageWithCapInsets(UIEdgeInsetsMake(22, 26, 22, 26)).imageWithRenderingMode(.AlwaysTemplate)
    static let blueBubbleImage = UIImage(named: "bubble_blue")!.resizableImageWithCapInsets(UIEdgeInsetsMake(22, 26, 22, 26)).imageWithRenderingMode(.AlwaysTemplate)

    let bubbleImageView: UIImageView = {
        let imageView = UIImageView()
        imageView.image = ChatLogMessageCell.grayBubbleImage
        imageView.tintColor = UIColor(white: 0.90, alpha: 1)
        return imageView
    }()

    override func setupViews() {
        super.setupViews()

        addSubview(textBubbleView)
        addSubview(messageTextView)

        textBubbleView.addSubview(bubbleImageView)
        textBubbleView.addConstraintsWithFormat("H:|[v0]|", views: bubbleImageView)
        textBubbleView.addConstraintsWithFormat("V:|[v0]|", views: bubbleImageView)
    }
}

extension UIView {

    func addConstraintsWithFormat(format: String, views: UIView...) {

        var viewsDictionary = [String: UIView]()
        for (index, view) in views.enumerated() {
            let key = "v\(index)"
            viewsDictionary[key] = view
            view.translatesAutoresizingMaskIntoConstraints = false
        }

        addConstraints(NSLayoutConstraint.constraints(withVisualFormat: format, options: NSLayoutFormatOptions(), metrics: nil, views: viewsDictionary))
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this custom cell, we can now add text to the message cells and the only thing left is to configure the frame size of each chat bubble. To implement this, we will need an array string of <code>4</code> messages which can be used to test anc calculate dynamic frame for each message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>let messages: [String] = ["Hello Susi", "I love FossAsia", "Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s", "The standard chunk of Lorem Ipsum used since the 1500s is reproduced below for those interested. Sections 1.10.32 and 1.10.33 from de Finibus Bonorum et Malorum"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>We now modify the <code>sizeForItemAt</code> method to calculate the frame size.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// Calculate Bubble Height
    func collectionView(_ collectionView: UICollectionView, layout collectionViewLayout: UICollectionViewLayout, sizeForItemAt indexPath: IndexPath) -&gt; CGSize {
        let message = messages[indexPath.row]

        let size = CGSize(width: 250, height: 1000)
        let options = NSStringDrawingOptions.usesFontLeading.union(.usesLineFragmentOrigin)
        let estimatedFrame = NSString(string: message).boundingRect(with: size, options: options, attributes: [NSFontAttributeName: UIFont.systemFont(ofSize: 18)], context: nil)

        return CGSize(width: view.frame.width, height: estimatedFrame.height + 20)
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>And accordingly modify the <code>cellForItemAt</code> method as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// Configure Cell
    override func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -&gt; UICollectionViewCell {

        let message = messages[indexPath.row]

        let cell = collectionView.dequeueReusableCell(withReuseIdentifier: cellId, for: indexPath) as! ChatLogMessageCell

        cell.messageTextView.textColor = .black

        let size = CGSize(width: 250, height: 1000)
        let options = NSStringDrawingOptions.usesFontLeading.union(.usesLineFragmentOrigin)
        let estimatedFrame = NSString(string: message).boundingRect(with: size, options: options, attributes: [NSFontAttributeName: UIFont.systemFont(ofSize: 18)], context: nil)

        if indexPath.row % 2 == 0 {

            cell.bubbleImageView.image = ChatLogMessageCell.grayBubbleImage
            cell.bubbleImageView.tintColor = .white
            cell.messageTextView.textColor = UIColor.black
            cell.messageTextView.frame = CGRect(x: 16, y: 0, width: estimatedFrame.width + 16, height: estimatedFrame.height + 30)
            cell.textBubbleView.frame = CGRect(x: 4, y: -4, width: estimatedFrame.width + 16 + 8 + 16, height: estimatedFrame.height + 20 + 6)

        } else {
            cell.messageTextView.frame = CGRect(x: view.frame.width - estimatedFrame.width - 16 - 16, y: 0, width: estimatedFrame.width + 16, height: estimatedFrame.height + 20)
            cell.textBubbleView.frame = CGRect(x:view.frame.width - estimatedFrame.width - 16 - 8 - 16, y: -4, width: estimatedFrame.width + 16 + 8 + 10, height: estimatedFrame.height + 20 + 6)
            cell.bubbleImageView.image = ChatLogMessageCell.blueBubbleImage
            cell.bubbleImageView.tintColor = UIColor.rgb(red: 220, green: 248, blue: 198)
        }

        cell.messageTextView.text = message

        return cell
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Below is the final output:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="http://imgur.com/4MQcd0I.png" alt="4MQcd0I.png"></span></p>
</div>
        </section>


        <footer class="post-footer">

                <section class="author">
                    <h4>Chashmeet Singh</h4>
                    <p>Full Stack Developer</p>
                </section>

            <section class="share">
                <h4>Share this</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=Calculation of the frame size of the Chat Bubble(iOS Client)&url=https://chashmeetsingh.github.io/"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://chashmeetsingh.github.io/"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https://chashmeetsingh.github.io/"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>


    </article>

</main>


    <footer class="site-footer">
        <!-- <a class="subscribe icon-feed" href="https://chashmeetsingh.github.io/rss/"><span class="tooltip">Subscribe!</span></a> -->
        <div class="inner">
             <section class="copyright">All content copyright <a href="/">Chashmeet Singh</a> &copy; 2017 &bull; All rights reserved.</section>
             <section class="poweredby">Proudly published with <a href="http://hubpress.io">HubPress</span></a> in <a href="https://github.com/mityalebedev/The-Shell">The Shell</a> theme.</section>
        </div>
    </footer>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();
      </script>
       
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

    <script type='text/javascript' src="//chashmeetsingh.github.io/themes/the-shell/assets/highlighter/prettify.js?v=1495476281331"></script>
    <script type='text/javascript' src="//chashmeetsingh.github.io/themes/the-shell/assets/js/shell.js?v=1495476281331"></script>
</body>
</html>
